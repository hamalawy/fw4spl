<plugin id="PoC04SofaInteractive">
  <requirement id="servicesReg" />

  <extension implements="::fwServices::registry::AppConfig">
    <id>PoC04SofaInteractive</id>
    <type>standard</type>
    <config>
    <object type="::fwData::Composite">

        <service uid="MyIHM" implementation="::gui::frame::DefaultFrame" type="::fwGui::IFrameSrv" autoComChannel="no">
          <gui>
            <frame>
              <name>Altran Est - Medic@ : PoC 4 - Principe de simulation interactive temps reel avec Sofa</name>
              <icon>Bundles/PoC04SofaInteractive_0-1/tuto.ico</icon>
              <minSize width="800" height="600"/>
            </frame>
            <menuBar />
          </gui>
          <registry>
            <menuBar sid="myMenuBar" start="yes" />
            <view sid="multiView_scene1" start="yes" />
          </registry>
        </service>

        <service uid="myMenuBar" type="::fwGui::IMenuBarSrv" implementation="::gui::aspect::DefaultMenuBarSrv" autoComChannel="no" >
          <gui>
            <layout>
              <menu name="File" />
              <menu name="Sofa" />
            </layout>
          </gui>
          <registry>
            <menu sid="menu_File" start="yes" />
            <menu sid="menu_Sofa" start="yes" />
          </registry>
        </service>

        <service uid="menu_File" type="::fwGui::IMenuSrv" implementation="::gui::aspect::DefaultMenuSrv" autoComChannel="no" >
          <gui>
            <layout>
              <menuItem name="Load patient" shortcut="Ctrl+O" />
              <separator />
              <menuItem name="Quit" specialAction="QUIT" shortcut="Ctrl+Q" />
            </layout>
          </gui>
          <registry>
            <menuItem sid="action_openFile" start="yes" />
            <menuItem sid="action_quit" start="yes" />
          </registry>
        </service>

        <service uid="menu_Sofa" type="::fwGui::IMenuSrv" implementation="::gui::aspect::DefaultMenuSrv" autoComChannel="no" >
          <gui>
            <layout>
              <menuItem name="Start" shortcut="Ctrl+S" />
              <!-- <menuItem name="Load scene" shortcut="Ctrl+L" /> -->
            </layout>
          </gui>
          <registry>
            <menuItem sid="mySofaWriterAction" start="no" />
            <!-- <menuItem sid="mySofaReaderAction" start="no" /> -->
          </registry>
        </service>

        <service uid="action_openFile" type="::fwGui::IActionSrv" implementation="::gui::action::StarterActionService" autoComChannel="no">
          <start uid="myReaderPathFile" />
        </service>

        <service uid="action_quit" type="::fwGui::IActionSrv" implementation="::gui::action::QuitAction" autoComChannel="no" />

        <service uid="multiView_scene1" type="::gui::view::IView" implementation="::gui::view::DefaultView" autoComChannel="no" >
          <gui>
            <layout type="::fwGui::CardinalLayoutManager">
              <view align="center" minWidth="200"/>
              <view align="right" minWidth="200" minHeight="200" position="0" />
              <view align="right" minWidth="200" minHeight="80" position="1" />
            </layout>
          </gui>
          <registry>
            <view sid="genericScene" start="yes" />
            <view sid="listOrganEditor" />
          </registry>
        </service>
        
      <!-- myPatientDB description -->
      <item key="myPatientDB">
        <object uid="myPatientDB" type="::fwData::PatientDB">
          <service uid="myReaderPathFile" implementation="::uiIO::editor::IOSelectorService" type="::gui::editor::IDialogEditor" autoComChannel="no">
            <type mode="reader" />
            <selection mode="exclude" />
            <addSelection service="::ioXML::FwXMLPatientDBReaderService" />
          </service>
          <service implementation="::ctrlSelection::wrapper::PatientDBWrapperSrv" type="::ctrlSelection::IWrapperSrv" uid="newOBject2newPatientDB" autoComChannel="yes" />
          <service uid="myUpdaterComCannelAcq" implementation="::fwServices::ComChannelService" type="::fwServices::ICommunication" autoComChannel="no">
            <target>myUpdaterAcq</target>
          </service>
        </object>
      </item>

      <!-- CompositeVisu description -->
      <item key="myCompositeVisu">
        <object uid="myCompositeVisu" type="::fwData::Composite">

          <service uid="myUpdaterAcq" implementation="::ctrlSelection::updater::AcqFromPDBUpdaterSrv" type="::ctrlSelection::IUpdaterSrv" autoComChannel="no">
            <update compositeKey="myAcquisition" onEvent="NEW_LOADED_PATIENT" fromUID="myPatientDB" actionType="ADD_OR_SWAP" />
            <update compositeKey="myAcquisition" onEvent="CLEAR_PATIENT" fromUID="myPatientDB" actionType="REMOVE" />
          </service>

          <service uid="myManager" implementation="::ctrlSelection::manager::SwapperSrv" type="::ctrlSelection::IManagerSrv" autoComChannel="yes" priority="0.6"  >
            <mode type="stop" />
            <config>

              <object id="myAcquisition" type="::fwData::Acquisition" >

                <service uid="listOrganEditor" implementation="::uiAcquisition::OrganListEditor" type="::gui::editor::IEditor" autoComChannel="yes" />

                <service uid="mySofaCore"
                       implementation="::opSofa::SofaCoreSrv"
                       type="::fwGui::IActionSrv" autoComChannel="yes" >
                </service>

                <service uid="mySofaWriter"
                           implementation="::opSofa::SofaSceneWriterSrv"
                         type="::io::IWriter" autoComChannel="no" >
                  <writeTrian>yes</writeTrian>
                  <sceneTemplate>templatetools.xml</sceneTemplate>
                  <useTempPath>yes</useTempPath>
                </service>

                <service uid="mySofaWriterAction"
                           implementation="::gui::action::StarterActionService"
                           type="::fwGui::IActionSrv" autoComChannel="no" >
                  <start uid="mySofaWriter"/>
                  <start uid="mySofaStart"/>
                  <start uid="myUpdaterComCannelSofa"/>
                </service>

                <!-- <service uid="mySofaReader"
                                     implementation="::opSofa::SofaSceneReaderSrv"
                                   type="::io::IReader" autoComChannel="no" >
                        </service> -->

                <!-- <service   uid="mySofaReaderAction"
                                   implementation="::gui::action::StarterActionService"
                                   type="::fwGui::IActionSrv" autoComChannel="no" >
                          <start uid="mySofaReader"/>
                          <start uid="mySofaStart"/>
                          <start uid="myUpdaterComCannelSofa"/>
                        </service> -->

                <service uid="mySofaStart"
                              implementation="::opSofa::SofaStartSrv"
                              type="::fwGui::IActionSrv" autoComChannel="no" >
                </service>

              </object>

            </config>
            
          </service>

          <service uid="genericScene" implementation="::fwRenderVTK::VtkRenderService" type="::fwRender::IRender" autoComChannel="yes">
            <scene>
              <picker id="myPicker" vtkclass="fwVtkCellPicker" />
              <renderer id="default" background="0.0" />
              <adaptor id="myRenderAdaptor" class="::visuVTKAdaptor::Render" objectId="self">
                <config renderer="default" picker="" />
              </adaptor>
              <adaptor id="myAcquisitionAdaptor" class="::visuVTKAdaptor::Acquisition" objectId="myAcquisition">
                <config renderer="default" picker="" />
              </adaptor>

              <vtkObject id="tool1MatrixTransform" class="vtkTransform" />
              <vtkObject id="tool2MatrixTransform" class="vtkTransform" />

              <adaptor id="tool1MeshAdaptor" class="::visuVTKAdaptor::Mesh" objectId="tool1Mesh">
                <config renderer="default" picker="myPicker" transform="tool1MatrixTransform" />
              </adaptor>

              <adaptor id="tool2MeshAdaptor" class="::visuVTKAdaptor::Mesh" objectId="tool2Mesh">
                <config renderer="default" picker="myPicker" transform="tool2MatrixTransform" />
              </adaptor>

              <adaptor id="tool1Widget" class="::opSofa::BoxWidget" objectId="view1">
                <config renderer="default" transform="tool1MatrixTransform" scaleFactor="2.0" enableScaling="no" idMesh="souris_mors2" />
              </adaptor>

              <adaptor id="tool2Widget" class="::opSofa::BoxWidget" objectId="view1">
                <config renderer="default" transform="tool2MatrixTransform" scaleFactor="2.0" enableScaling="no" idMesh="souris_cam" />
              </adaptor>

              <!-- <adaptor id="myWolrdAxes" class="::visuVTKAdaptor::Axes" objectId="self">
                        <config renderer="default" length="5" label="no" />
                      </adaptor> -->

            </scene>
          </service>

          <item key="view1">
            <object uid="view1" type="::fwData::TransformationMatrix3D">
              <service uid="myUpdaterComCannelSofa" implementation="::fwServices::ComChannelService" type="::fwServices::ICommunication" autoComChannel="no">
                <target>mySofaCore</target>
              </service>
            </object>
          </item>

          <item key="tool1Mesh">
            <object uid="tool1Mesh" type="::fwData::Mesh">
              <service uid="tool1ReaderFile" implementation="::ioData::MeshReaderService" type="::io::IReader" autoComChannel="no" >
                <filename>Bundles/opSofa_0-1/cam.trian</filename>
              </service>
            </object>
          </item>

          <item key="tool2Mesh">
            <object uid="tool2Mesh" type="::fwData::Mesh">
              <service uid="tool2ReaderFile" implementation="::ioData::MeshReaderService" type="::io::IReader" autoComChannel="no" >
                <filename>Bundles/opSofa_0-1/mors2.trian</filename>
              </service>
            </object>
          </item>
        </object>
      </item>

      <start uid="MyIHM" />
      <start uid="myUpdaterAcq" />
      <start uid="myManager" />
      <start uid="myUpdaterComCannelAcq" />
      <start uid="newOBject2newPatientDB"/>
      <start uid="tool1ReaderFile"/>
      <start uid="tool2ReaderFile"/>

      <update uid="tool1ReaderFile"/>
      <update uid="tool2ReaderFile"/>

    </object>
    </config>
  </extension>
</plugin>
