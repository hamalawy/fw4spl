<extension implements="::fwServices::registry::AppConfig">
    <id>Blend</id>
    <type>parameters</type>
    <parameters>
        <param name="WID_PARENT" />
        <param name="GENERIC_UID" />
        <param name="SELECTED_UID_compositeSelection" />
    </parameters>

    <config>

        <object type="::fwData::Composite">

            <service uid="${GENERIC_UID}_mainView" type="::gui::view::IView" impl="::gui::view::DefaultView" autoConnect="no">
                <gui>
                    <layout type="::fwGui::CardinalLayoutManager">
                        <view align="center" />
                    </layout>
                    <toolBar />
                </gui>
                <registry>
                    <parent wid="${WID_PARENT}" />
                    <toolBar sid="${GENERIC_UID}_toolBar" start="yes" />
                    <view wid="${GENERIC_UID}_WID_VIEW" start="no" />
                </registry>
            </service>

            <service uid="${GENERIC_UID}_toolBar" type="::fwGui::IToolBarSrv" impl="::gui::aspect::DefaultToolBarSrv" autoConnect="no">
                <gui>
                    <layout>
                        <menuItem name="Import Image 1" icon="Bundles/icons_0-1/icons/icon-load1.png" />
                        <menuItem name="Import Image 2" icon="Bundles/icons_0-1/icons/icon-load2.png" />
                        <separator />
                        <menuItem name="Blend view" style="radio" icon="Bundles/icons_0-1/icons/icon-2D.png" />
                        <menuItem name="Edit background Image TF" style="radio" icon="Bundles/icons_0-1/icons/icon-tf1.svg" />
                        <menuItem name="Edit front Image TF" style="radio" icon="Bundles/icons_0-1/icons/icon-tf2.svg" />
                    </layout>
                </gui>
                <registry>
                    <menuItem sid="${GENERIC_UID}_action_LoadImage1" start="no" />
                    <menuItem sid="${GENERIC_UID}_action_LoadImage2" start="no" />
                    <menuItem sid="${GENERIC_UID}_action_blendView" start="no" />
                    <menuItem sid="${GENERIC_UID}_action_bgTFView" start="yes" />
                    <menuItem sid="${GENERIC_UID}_action_frontTFView" start="yes" />
                </registry>
            </service>

            <item key="TFSelectionsKey">
                <object uid="${GENERIC_UID}_TFComposite" type="::fwData::Composite" />
            </item>

            <item key="myBlendSelectionComposite">
                <object uid="${GENERIC_UID}_myBlendSelectionComposite" type="::fwData::Composite">

                    <service uid="${GENERIC_UID}_myManagerLockDump" impl="::ctrlMemory::manager::LockDumpManagerSrv" type="::ctrlSelection::IManagerSrv" autoConnect="yes" /> <!--priority="0.65" -->

                    <service uid="${GENERIC_UID}_myUpdater" impl="::ctrlSelection::updater::ObjFromMsgUpdaterSrv" type="::ctrlSelection::IUpdaterSrv" autoConnect="no">
                        <update compositeKey="myBackgroundImage" onEvent="NEW_BACKGROUND_IMAGE" fromUID="*" actionType="ADD_OR_SWAP" />
                        <update compositeKey="myFrontImage" onEvent="NEW_FRONT_IMAGE" fromUID="*" actionType="ADD_OR_SWAP" />
                    </service>

                    <service uid="${GENERIC_UID}_action_blendView" type="::fwGui::IActionSrv" impl="::gui::action::ConfigActionSrv" autoConnect="yes">
                        <state active="true" />
                        <config id="ImageMix" />
                        <replace pattern="SELECTED_myBlendSelectionComposite" val="${GENERIC_UID}_myBlendSelectionComposite" />
                        <replace pattern="WID_VIEW" val="${GENERIC_UID}_WID_VIEW" />
                        <replace pattern="TF_COMPOSITE_ID" val="${GENERIC_UID}_TFComposite" />
                        <replace pattern="SELECTED_TF_KEYA" val="tfBackgroundImage" />
                        <replace pattern="SELECTED_TF_KEYB" val="tfFrontImage" />
                    </service>

                    <service uid="${GENERIC_UID}_action_bgTFView" type="::fwGui::IActionSrv" impl="::gui::action::ConfigActionSrvWithKey" autoConnect="yes">
                        <config id="TransferFunctionEditor" />
                        <key id="myBackgroundImage" pattern="SELECTED_UID_myImage" />
                        <replace pattern="WID_VIEW" val="${GENERIC_UID}_WID_VIEW" />
                        <replace pattern="TF_COMPOSITE_ID" val="${GENERIC_UID}_TFComposite" />
                        <replace pattern="SELECTED_TF_KEY" val="tfBackgroundImage" />
                    </service>

                    <service uid="${GENERIC_UID}_action_frontTFView" type="::fwGui::IActionSrv" impl="::gui::action::ConfigActionSrvWithKey" autoConnect="yes">
                        <config id="TransferFunctionEditor" />
                        <key id="myFrontImage" pattern="SELECTED_UID_myImage" />
                        <replace pattern="WID_VIEW" val="${GENERIC_UID}_WID_VIEW" />
                        <replace pattern="TF_COMPOSITE_ID" val="${GENERIC_UID}_TFComposite" />
                        <replace pattern="SELECTED_TF_KEY" val="tfFrontImage" />
                    </service>
                </object>
            </item>

            <item key="myCompositeSelection">
                <object uid="${SELECTED_UID_compositeSelection}" src="ref" type="::fwData::Composite">
                    <service uid="${GENERIC_UID}_myManager" impl="::ctrlSelection::manager::SwapperSrv" type="::ctrlSelection::IManagerSrv" autoConnect="yes" >
                        <mode type="stop" />
                        <config>

                            <object id="myImage" type="::fwData::Image">

                                <service uid="${GENERIC_UID}_action_LoadImage1" impl="::gui::action::ActionNotifyService" type="::fwGui::IActionSrv" autoConnect="no">
                                    <notify type="::fwComEd::ImageMsg" event="NEW_BACKGROUND_IMAGE" />
                                </service>

                                <service uid="${GENERIC_UID}_action_LoadImage2" impl="::gui::action::ActionNotifyService" type="::fwGui::IActionSrv" autoConnect="no">
                                    <notify type="::fwComEd::ImageMsg" event="NEW_FRONT_IMAGE" />
                                </service>

                                <!--
                                <service impl="::fwServices::ComChannelService" type="::fwServices::ICommunication" autoConnect="no">
                                    <target>${GENERIC_UID}_myUpdater</target>
                                </service>
                                -->
                                <connect>
                                    <signal>objectModified</signal>
                                    <slot>${GENERIC_UID}_myUpdater/receive</slot>
                                </connect>
                            </object>

                        </config>
                    </service>
                </object>
            </item>

            <!-- START AND STOP SERVICES -->
            <start uid="${GENERIC_UID}_mainView" />
            <start uid="${GENERIC_UID}_myUpdater" />
            <start uid="${GENERIC_UID}_myManagerLockDump" />
            <start uid="${GENERIC_UID}_myManager" />
            <start uid="${GENERIC_UID}_action_blendView" />

        </object>


    </config>
</extension>

